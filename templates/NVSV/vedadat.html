{% load static %}
{% load filter %}
<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700" rel="stylesheet">

    <title>Ramayana - Free Bootstrap 4 CSS Template</title>

    <!-- Bootstrap core CSS -->
    <link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">

<!--
Ramayana CSS Template
https://templatemo.com/tm-529-ramayana
-->

    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="{% static 'assets/css/fontawesome.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/templatemo-style.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/owl.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/shortcodes.css' %}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,700">


  </head>

<body class="is-preload">

    <!-- Wrapper -->
    <div id="wrapper">

      <!-- Main -->
        <div id="main">
          <div class="inner">

            <!-- Header -->
            <header id="header" style="margin: -100px -100px 50px -100px;">
              <div class="logo">
                <div class="btn-group mb-2 mr-2">
                  <a style="font-size: 15px;"> Xin chào! </a>
                </div>
              </div>
            </header>

            <!-- Breadcrumb -->

            <!-- Tìm kiếm lịch tình -->
            <section class="forms" style="border-bottom: none;">
              <div class="container-fluid">
                <div class="row">
                  <div class="col-md-12">
                    <div class="section-heading">
                      <h2 id="chitiet">Tìm kiếm lịch trình</h2>
                    </div>
                    <form id="contact" action="" method="get">
                      {% csrf_token %}
                      <div class="row">
                        <div class="col-md-4">
                          <fieldset>
                            <input type="text" name="tram" class="form-control" placeholder="Trạm">
                          </fieldset>
                        </div>
                        <div class="col-md-4">
                          <fieldset>
                            <input type="time" name="tgxb" class="form-control" id="xnmk" placeholder="Xuất bến">
                          </fieldset>
                        </div>
                        <div class="col-md-4">
                          <fieldset>
                            <input type="time" name="tgdb" class="form-control" placeholder="Đến bến">
                          </fieldset>
                        </div>
                        <div class="col-md-4">
                          <fieldset>
                            <input type="text" name="sdt" class="form-control" placeholder="Số điện thoại khách hàng">
                          </fieldset>
                        </div>
                        <div class="col-md-12">
                          <button formaction="../../ticket/search" type="submit" id="" class="button">Tìm kiếm</button>
                        </div>
                        <div class="col-md-12" style="padding-top: 10px;"><a style="color: {{color}};">{{m}}</a></div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </section>

            <!-- Tables -->
            <section class="tables">
              <div class="container-fluid">
                <div class="row">
                  <div class="col-md-12">
                    <div class="section-heading">
                      <h2> Danh sách tìm kiếm</h2>
                    </div>
                    <div class="default-table table-wrapper-scroll-y my-custom-scrollbar">
                      <table>
                        <thead>
                          <tr>
                            <th>Tuyến xe</th>
                            <th>Xuất bến</th>
                            <th>Đến bến</th>
                            <th>Số vé</th>
                            <th>Hành khách</th>
                            <th></th>
                            <th></th>
                          </tr>
                        </thead>
                       <form method="post" id="form_huyve">
                        {% csrf_token %}
                        <tbody>
                        {% for k in data %}
                            <tr>
                              <td>
                                  {% for h in k.TuyenXe %}
                                      {% if h.MaTram.TenDuong == tram %} --<b style="color: blue;">{{h.MaTram.TenDuong}}</b> {% else %} --{{h.MaTram.TenDuong}} {% endif %}
                                  {% endfor %}--
                              </td>
                              <td class="tgxb">{{k.ChiTietVe.0.TGXuatBen}}</td>
                              <td>{{k.ChiTietVe.0.TGDenBen}}</td>
                              <td data-th="Quantity">
                                <input type="number" style="width: 75%; height: 70%; font-size: 13px;" class="form-control form-control-lg text-center sl" name="soluong" value="{{k.SL}}">
                              </td>
                              <td>{{k.TTDonHang.0.TTKH.HoTen}}</td>
                              <td>
                                <button type="submit" class="btn btn-labeled btn-danger huyve" value="{{k.Ve}}">
                                  <span class="btn-label"><i class="fa fa-remove"></i></span>
                                </button>
                              </td>
                              <td>
                                 <input type="hidden" value="{{k.MaDH}}" class="mdh">
                              </td>
                            </tr>
                        {% endfor %}
                        <!---->
                        </tbody>
                       </form>
                      </table>

                    </div>
                  </div>
                </div>
              </div>
            </section>
          </div>
        </div>

      <!-- Sidebar -->
        <div id="sidebar">

          <div class="inner">

            <!-- Search Box -->
            <section id="search" class="alt">
              <img src="{% static 'assets/images/bus.png' %}" style="width: 50%; height: 100%; padding-left: 60px;" alt="">
            </section>
              
            <!-- Menu -->
           <nav id="menu">
              <ul>
                <li>
                  <span class="opener">Thông tin cá nhân</span>
                  <ul>
                    <li><a href="../../usr/information"><i style="font-family: 'FontAwesome'; font-style: normal" class="fa-plus"></i>  Cập nhật thông tin cá nhân </a></li>
                    <li><a href="../../usr/changepassword"><i style="font-family: 'FontAwesome'; font-style: normal" class="fa-edit"></i>  Thay đổi mật khẩu  </a></li>
                  </ul>
                </li>
                <li><a href="../../bus_routes">Lịch trình</a></li>
                <li><a href="#" style="color: #535ba0;">Vé đã đặt</a></li>
                <li><a href="../fhwflhwdklfhwqplfijepoqf9u4038586885889882wdnadakdD872182CMMFKFKFOKFLASIUOVBJHFJ">Đăng xuất</a></li>
              </ul>
            </nav>

            <!-- Featured Posts -->
            <div class="featured-posts">
              <div class="heading">
                <h2>Featured Posts</h2>
              </div>
              <div class="owl-carousel owl-theme">
                <a href="#">
                  <div class="featured-item">
                    <img src="{% static 'assets/images/featured_post_01.jpg' %}" alt="featured one">
                    <p>Aliquam egestas convallis eros sed gravida. Curabitur consequat sit.</p>
                  </div>
                </a>
                <a href="#">
                  <div class="featured-item">
                    <img src="{% static 'assets/images/featured_post_01.jpg' %}" alt="featured two">
                    <p>Donec a scelerisque massa. Aliquam non iaculis quam. Duis arcu turpis.</p>
                  </div>
                </a>
                <a href="#">
                  <div class="featured-item">
                    <img src="{% static 'assets/images/featured_post_01.jpg' %}" alt="featured three">
                    <p>Suspendisse ac convallis urna, vitae luctus ante. Donec sit amet.</p>
                  </div>
                </a>
              </div>
            </div>

            <!-- Footer -->
            <footer id="footer">
              <p class="copyright">Copyright &copy; 2019 Company Name
              <br>Designed by <a rel="nofollow" href="https://www.facebook.com/templatemo">Template Mo</a></p>
            </footer>
            
          </div>
        </div>

    </div>

  <!-- Scripts -->
  <!-- Bootstrap core JavaScript -->
    <script src="{% static 'vendor/jquery/jquery.min.js' %}"></script>
    <script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>

    <script src="{% static 'assets/js/browser.min.js' %}"></script>
    <script src="{% static 'assets/js/breakpoints.min.js' %}"></script>
    <script src="{% static 'assets/js/transition.js' %}"></script>
    <script src="{% static 'assets/js/owl-carousel.js' %}"></script>
    <script src="{% static 'assets/js/custom.js' %}"></script>
    <script>
      var sl = $(".sl").val();
      $(".sl").change(function () {
           if (($(this).val() > sl) || ($(this).val() == 0)) {
              alert('Số lượng vé không hợp lệ!');
              $(this).val(sl);
           }
      });
      $(".huyve").click(function (e) {
            e.preventDefault();
            var tr = $(this).parent().parent();
            var ve = $(this).val();
            var sl_ve = tr.find(".sl").val();
            var madh = tr.find(".mdh").val();
            var tgxb = tr.find(".tgxb").text() ;
<!--            alert(madh);-->
            alert("Bạn có chắc muốn hủy vé?");
            // POST AJAX request
            $.ajax({
               type: 'POST',
               url: "cancel",
               data: {
                  've': ve,
                  'sl': sl_ve,
                  'madh': madh,
                  'tgxb': tgxb
               },
               success: function (response) {
                   alert(response['tb']);
<!--                    window.location.href = "../ticket";-->
                   location.reload();
               },
               error: function (response) {
                  console.log(response)
               }
            })
       });
    </script>
</body>


  </body>

</html>
